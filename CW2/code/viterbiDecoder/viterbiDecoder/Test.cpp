#pragma once

#include <iostream>
#include <string>

#include "burst.h"
#include "Viterbi.h"
#include "common.h"

using namespace std;

void menu() {
	cout << "Menu" << endl;
	cout << "Please enter the apropriate number for the function you wish to exicute;" << endl;
	cout << "1; Decode Default Encryption" << endl;
	cout << "2; Decode All Encryption" << endl;
	cout << "3; Delete All the decoded files" << endl;
	cout << "4; Exit" << endl;
}

void main() {

	common *c = new common;

	vector<string> *fnames = new vector<string>;
	vector<Viterbi> *viturbies = new vector<Viterbi>;
	Viterbi *v = new Viterbi(3, 2, 1, 0, 2, 2);

	//this is bad
	string test = "0000000010001110111101111011111111011100110011101111110111101111011110010110101101011010111111111111111111111111111111010110101111111101111011111101111011111111110111101111011110111111111101111011111111011110111111111111110111101111111111111111011110010100000000000000000010000100101011011110111111111111110101001000111001111011111111110111000100100001101011111101111011111111111111111111011110111101111011110111101111111111011110111111110111100101000000101011011110111111111111111111110111101111111111111111111101111011111111011110111101111011111111011100110001001010111111111111111111111111011110111111110111101111111101111011111111111111111111111111111111111111010100001010111111111101110001101001011010010110101111111101011010011110111111011110011110111101111011111101111011111101111011111111111111111111011110111111111111111111111111011110111111111111010110101111111101111011111111111111111111011110111111111111111101111011111111011110111111111111111111110111101111111111111111111111110111100111101111010100000010101111010100000000101001111001010000000010100101000000101011111111010100001010011100010010101101011000110001101011111111111111111111111111111111011110111111111111011100111011111111111111111101111011111111111111110111101111111111111111111101111011111111111101111011111111111111110111101111111111111111111101110001000010101111111101111011111111111101011010111101111011110101101011111111011110110111101111111111111111111101111001111011110101101011111111111111111111111111110111101111111111111111111111111111011110011110111111011110111111111111111111011110111111111111111111110111101111111111110111101111111111111111011110111111110111101111111111111111011110111111111111011110111111111111111111111111011110111101111011111111011110111111111111111111111111111101110011001110111111110111100111101111111101111011111111111101111011111111111111110111101111111111111111011110111111111111011110111111111111111101111011110111101111011110111111111101111011111111011110010100000010101101111011111111111111111111011110111111111111111111110111101111111101111011110111101111111101110011000100101011111111111111111111111101111011111111011110111111110111001110110111101111111111111111111101110011101101111011111111111111111111111111111101010000101011111111110111000110100101101001011010111111110101101001111011111101111001111011110111101111110111101111110111101111111111111111111101111011111111111111111111111101111011111111111101011010111111110111101111111111111111111101111011111111111111110111101111111101111011111111111111111111011110111111111101011010111111111111110111101111111111111111011110011110111111110111001110111111111111011110111111111101111001111011110101101011111111111101111011111111111101111011111111111111111111111111010100001010111111111101111011111111111111110111101111010100000000101001111001010000000010100101000000101011111111010100001010011100010010101101011000110001101011111111111111111111111111111111011110111111111111011100111011111111111111111101111011111111111111110111101111111111111111111101111011111111111101111011111111111111110111101111111111111111111101110001000010101111111101111011111111111101011010111101111011110101101011111111011110111111111101110001101001011010010110101111111101011010011110111111011110011110111101111011111101111011111101111011111111111111111111011110111111111111111111111111011110111111111111010110101111111101111011111111111111111111011110111111111111111101111011111111011110111111111111111111110111101111111111010110101111111111111101111011111111111111110111100111101111111101110011101111111111110111101111111111011110011110111101011010111111111111011110111111111111011110111111111111111111111111110101000010101111111111011110111111111111111101111011110101000000001010011110010100000000101001010000001010111111110101000010100111000100101011010110001100011010111111111111111111111111111111110111101111111111110111001110111111111111111111011110111111111111111101111011111111111111111111011110111111111111011110111111111111111101111011111111111111111111011100010000101011111111011110111111111111010110101111011110111101011010111111110111101101";
	int x = 0;
	string command = "del /Q ";
	string path = "Decoded\\*.txt";
	int count = 0;

	menu();
	while (x != -5) {
		cin >> x;
		while (!(cin >> x)) {
			cin.clear();
			cin.ignore(numeric_limits<streamsize>::max(), '\n');
			cout << "Invalid input.  Try again: ";
		}
		switch (x)
		{
		case 1:
			cout << "Decodeding Default Encryption" << endl;			
			cout << "Encoded File: " << test << endl << endl;
			cout << "Decoded File : " << v->decode(test) << endl;
			menu();
			break;
		case 2:
			cout << "Decoding All Encryption";
			c->readinlbl("filenames.txt", fnames);
			count = 0;
			for each (string s in *fnames)
			{
				int r3 = (int)(s[5] - 48);
				int r2 = (int)(s[12] - 48);
				int r1 = (int)(s[19] - 48);
				int i1 = (int)(s[29] - 48);
				int xorc1 = (int)(s[39] - 48);
				int xorc2 = (int)(s[49] - 48);
				viturbies->push_back(Viterbi(r3, r2, r1, i1, xorc1, xorc2));
			}
			
			for each(Viterbi v in *viturbies) {
				string file = ("Encoded\\" + fnames->at(count));
				string temp = v.decode(c->readin(file));
				c->printtofile("Decoded\\" + fnames->at(count) + " Decoded", temp);
				count++;
			}
			cout << "Decoding Complete" << endl;
			menu();
			break;
		case 3:
			cout << "Deleting all Decoded .txt Files" << endl;
			system(command.append(path).c_str());
			break;
		case 4:
			cout << "Now exiting from program" << endl;
			cout << "Bye Bye";
			x = -5;
			break;
		default:
			cin.clear();
			cout << "Please enter a valid option" << endl;
		}

		//burst *b = new burst();
		//cout << b->addErrors(test) << endl;
		
	}
	delete fnames;
	delete viturbies;
}

	